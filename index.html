<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Receitas WikiFood</title>
<link rel="stylesheet" href="css/wikifood.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>

<!-- NAVBAR COM FUNDO LARANJA E LETRAS BRANCAS -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <!-- Logo -->
    <a class="navbar-brand text-white d-flex align-items-center" href="index.html">
      <img src="assets/logo-padrao.jpg" alt="WikiFood Logo" style="height:40px; margin-right:8px;">
      WikiFood
    </a>

    <!-- Botão hamburguer -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Links -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto" style="gap: 1rem;">
        <li class="nav-item">
          <a class="nav-link text-white" href="index.html">Início</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="pages/empresas-listagem.html">Empresas</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="pages/cadastros.html">Cadastre-se aqui!</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="background-container">
  <div class="content">
    <div class="container">
      <h2 class="titulo-branco">Lista de Receitas</h2>
      <div id="receitasList"></div>
    </div>

<!-- ===================== SCRIPT CORRIGIDO ===================== -->
<script>
const token = 'Bearer SEU_TOKEN_AQUI'; // Substitua pelo token válido

async function carregarReceitas() {
  const listContainer = document.getElementById('receitasList');
  listContainer.innerHTML = 'Carregando receitas...';

  try {
    const response = await fetch('https://wikifood.gustavoanjos.com/api/Receipt', {
      headers: { 'Authorization': token }
    });

    if (!response.ok) {
      listContainer.innerHTML = `Erro ao carregar receitas: ${response.status}`;
      return;
    }

    const receitas = await response.json();
    listContainer.innerHTML = '';

    if (!Array.isArray(receitas) || receitas.length === 0) {
      listContainer.innerHTML = 'Nenhuma receita encontrada.';
      return;
    }

    receitas.forEach(r => {
      const div = document.createElement('div');
      div.className = 'receita';
      div.dataset.id = r.id;

      // IMAGEM
      const img = document.createElement('img');
      img.className = 'receita-img';
      img.src = r.imageUrl ? "https://wikifood.gustavoanjos.com" + r.imageUrl : "assets/placeholder.jpg";
      img.alt = r.title || "Imagem da receita";
      div.appendChild(img);

      // TÍTULO
      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = r.title || 'Sem título';
      div.appendChild(title);

      // DESCRIÇÃO
      const desc = document.createElement('div');
      desc.className = 'description';
      desc.textContent = r.description || 'Sem descrição';
      div.appendChild(desc);

      div.addEventListener('click', () => expandCard(div, r.id));

      listContainer.appendChild(div);
    });

  } catch (error) {
    listContainer.innerHTML = 'Erro de comunicação com a API!';
    console.error(error);
  }
}

carregarReceitas();

async function expandCard(card, id) {
  let overlay = document.createElement("div");
  overlay.classList.add("overlay", "active");
  document.body.appendChild(overlay);

  // container da lore separado e estilizado
  let loreBox = document.createElement("div");
  loreBox.classList.add("lore-box");
  loreBox.style.marginTop = "15px";
  loreBox.style.paddingTop = "10px";
  loreBox.style.borderTop = "1px solid rgba(255,255,255,0.3)";
  loreBox.style.whiteSpace = "pre-line"; // permite parágrafos
  loreBox.textContent = "Carregando histórico da receita...";
  card.appendChild(loreBox);

  // busca do histórico
  try {
    const response = await fetch(`https://wikifood.gustavoanjos.com/api/Receipt/${id}/lore`, {
      headers: { 'Authorization': token }
    });

    if (response.ok) {
      const lore = await response.text();
      loreBox.textContent = lore || "Nenhum histórico disponível.";
    } else {
      loreBox.textContent = "Histórico não disponível.";
    }
  } catch {
    loreBox.textContent = "Erro ao carregar histórico.";
  }

  card.classList.add("expanded");

  overlay.addEventListener("click", () => {
    card.style.animation = "fadeOut 0.4s forwards";
    setTimeout(() => {
      card.classList.remove("expanded");
      card.style.animation = "";
      loreBox.remove();
      overlay.remove();
    }, 400);
  });
}
</script>
<!-- ============================================================ -->

<button onclick="window.scrollTo({ top: 0, behavior: 'smooth' })" class="voltar-topo">
  Voltar ao Início
</button>

  </div>
</div>

<footer class="footer">
  <p>&copy; 2025 WikiFood.</p>
  <p>Todos os direitos reservados.</p>
  <p>Sabores do Brasil e do mundo em um só lugar.</p>
  <div class="social-icons">
    <a href="#"><i class="fab fa-instagram"></i></a>
    <a href="#"><i class="fab fa-facebook"></i></a>
    <a href="#"><i class="fab fa-whatsapp"></i></a>
  </div>
</footer>

</body>
</html>

